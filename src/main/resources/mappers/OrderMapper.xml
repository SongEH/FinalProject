<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="first.final_project.dao.OrderMapper">
  <!-- 전체조회  -->
  <!-- <select id="selectList" resultType="carts">
     select * from carts order by carts_id desc
  </select> -->

  <select id="selectList" parameterType="int" resultType="order">
     SELECT
        o.orders_id,
            <!-- o.orders_payment, -->
        o.orders_name AS orders_name,
        o.orders_price,
            <!-- o.orders_srequest, -->
    <!-- o.orders_drequest, -->
        o.orders_cdate,
        o.orders_status,
            <!-- o.shop_id, -->
    <!-- o.addr_id, -->
    <!-- o.member_id, -->
        s.shop_name AS shop_name,
        s.shop_img AS shop_img,
        COUNT(c.menu_id) AS menu_count
    FROM orders o
    JOIN shop s ON o.shop_id = s.shop_id
    LEFT JOIN carts c ON o.orders_id = c.orders_id
    LEFT JOIN addr a ON o.addr_id = a.addr_id 
    WHERE o.member_id = #{member_id}
    GROUP BY o.orders_id, s.shop_name, s.shop_img     <!--, a.addr1, a.addr2; -->
  </select>



  <!-- carts_id 에 해당되는 CartsVo 조회  -->
  <select id="selectOne" parameterType="int" resultType="order">
     SELECT
        o.orders_id,
            <!-- o.orders_payment, -->
        o.orders_name AS orders_name,
        o.orders_price,
            <!-- o.orders_srequest, -->
    <!-- o.orders_drequest, -->
        o.orders_cdate,
        o.orders_status,
            <!-- o.shop_id, -->
    <!-- o.addr_id, -->
    <!-- o.member_id, -->
        s.shop_name AS shop_name,
        s.shop_img AS shop_img,
        COUNT(c.menu_id) AS menu_count
    FROM orders o
    JOIN shop s ON o.shop_id = s.shop_id
    LEFT JOIN carts c ON o.orders_id = c.orders_id
    LEFT JOIN addr a ON o.addr_id = a.addr_id 
    WHERE o.orders_id = #{orders_id}
    GROUP BY o.orders_id, s.shop_name, s.shop_img     <!--, a.addr1, a.addr2; -->
  </select>



  <!-- 등록 : !!!!!!!!!!!!!!! payment와 중복된다 -->
  <!-- <insert id="insert" parameterType="order">
    INSERT INTO Orders(
        orders_payment, 
        orders_price, 
        orders_srequest,
        orders_drequest, 
        orders_cdate,
        shop_id,
        addr_id,
        orders_name,
        member_id 
    )
    VALUES (
        #{orders_payment}, 
        #{orders_price}, 
        #{orders_srequest}, 
        #{orders_drequest}, 
        CURRENT_DATE,
        #{shop_id}, 
        #{addr_id}, 
        #{orders_name},
        #{member_id}
    );
   </insert> -->

  <!-- 삭제 -->
  <delete id="delete" parameterType="int">
     delete from Orders
     where order_id=#{order_id}
  </delete>



</mapper>












